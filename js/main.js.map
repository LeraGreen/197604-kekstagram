{"version":3,"sources":["webpack:///webpack/bootstrap 3f4b0e244352c3525fb9","webpack:///./src/js/main.js","webpack:///./src/js/pictures.js","webpack:///./src/js/load.js","webpack:///./src/js/gallery.js","webpack:///./src/js/picture.js","webpack:///./src/js/utils.js","webpack:///./src/js/superclass.js","webpack:///./src/js/picture-model.js","webpack:///./src/js/upload.js","webpack:///./src/js/cookies.js","webpack:///./src/js/resizer.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;iQCtCA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA,EAAC;;AAED;AACA;AACA,EAAC;;AAED;AACA;AACA,EAAC;;AAED;AACA;AACA,EAAC;;;;;;;ACpBD;;AAEA,oHACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;;AAEA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,QAAO;AACP;;AAEA;AACA;AACA;AACA,IAAG;;;;;;;;;;;;;;;;;AC3GH;;AAEA;;AAEA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,EAAC;;;;;;;ACrBD;;AAEA,oKACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA;AACA;AACA,YAAW;AACX;;AAEA,QAAO;AACP;;AAEA;AACA,IAAG;;;;;;;AC3HH;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP,MAAK;;AAEL;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA,EAAC;;;;;;;AC3DD;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,EAAC;;;;;;;ACbD;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,EAAC;;;;;;;ACpBD;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,EAAC;;;;;;;;ACzCD;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,+EAA8E;AAC9E,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,gBAAe,OAAO;AACtB;AACA;AACA;AACA;AACA;AACA;;AAEA,gBAAe,OAAO;AACtB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,eAAc;AACd;AACA;;AAEA;AACA,eAAc;AACd;AACA;;AAEA;AACA;AACA,eAAc;AACd;AACA;;;AAGA;AACA,gCAA+B,cAAc;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,iBAAgB;AAChB;;AAEA;;AAEA,oBAAmB,2BAA2B;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,eAAc;AACd;AACA;;AAEA;AACA;AACA,eAAc;AACd;AACA;;;AAGA;AACA;AACA,eAAc;AACd;AACA;;AAEA;AACA,eAAc;AACd;AACA;;AAEA;AACA,eAAc;AACd;AACA;;AAEA;AACA,gBAAe,OAAO;AACtB,gBAAe,QAAQ;AACvB,iBAAgB;AAChB;AACA;AACA;;AAEA;AACA;AACA,oDAAmD;AACnD;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,gBAAe,MAAM;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,YAAW;;AAEX;AACA,UAAS;AACT;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA,gBAAe,MAAM;AACrB;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,MAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,MAAK;;AAEL;AACA;AACA;AACA,gBAAe,MAAM;AACrB;AACA;AACA;;AAEA;AACA;;AAEA;AACA,oBAAmB,uBAAuB;AAC1C;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA,gBAAe,MAAM;AACrB;AACA;AACA;;AAEA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA,gBAAe,MAAM;AACrB;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,QAAO;;AAEP;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA,IAAG;AACH,EAAC;;;;;;;ACjVD;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,kDAAiD,kCAAkC;AACnF;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,EAAC;;;;;;;ACjDD;;AAEA;AACA;AACA;AACA;AACA,gBAAe,OAAO;AACtB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAkB;AAClB;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,QAAO;;AAEP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAgB;AAChB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,iBAAgB;AAChB;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAgB;AAChB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,YAAW;AACX;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,QAAO;;AAEP;AACA;AACA;AACA;AACA,kBAAiB,OAAO;AACxB,kBAAiB,OAAO;AACxB;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;;AAEP;AACA;AACA,kBAAiB,OAAO;AACxB,kBAAiB,OAAO;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;;AAEP;AACA,kBAAiB,WAAW;AAC5B;AACA;AACA;AACA;AACA,QAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;;AAEP;AACA;AACA,kBAAiB,WAAW;AAC5B;AACA;AACA;AACA;AACA,QAAO;;AAEP;AACA;AACA,kBAAiB,QAAQ;AACzB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAO;;AAEP;AACA;AACA,mBAAkB;AAClB;AACA;AACA;AACA,QAAO;;AAEP;AACA;AACA,kBAAiB,OAAO;AACxB,kBAAiB,OAAO;AACxB,kBAAiB,OAAO;AACxB;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;;AAEP;AACA,kBAAiB,OAAO;AACxB,kBAAiB,OAAO;AACxB,kBAAiB,OAAO;AACxB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,QAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,QAAO;;AAEP;AACA;AACA;AACA,mBAAkB;AAClB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAe,OAAO;AACtB,gBAAe,OAAO;AACtB,gBAAe,OAAO;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAe,OAAO;AACtB,gBAAe,OAAO;AACtB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,IAAG;AACH,EAAC","file":"js/main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 3f4b0e244352c3525fb9\n **/","'use strict';\r\n\r\ndefine(['./pictures.js'], function(pictures) {\r\n  return pictures;\r\n});\r\n\r\ndefine(['./upload.js'], function(upload) {\r\n  return upload;\r\n});\r\n\r\ndefine(['./resizer.js'], function(resizer) {\r\n  return resizer;\r\n});\r\n\r\ndefine(['./gallery.js'], function(gallery) {\r\n  return gallery;\r\n});\r\n\r\ndefine(['./utils.js'], function(utils) {\r\n  return utils;\r\n});\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/js/main.js\n ** module id = 0\n ** module chunks = 0\n **/","'use strict';\r\n\r\ndefine(['./load.js', './gallery.js'],\r\n  function(load, gallery) {\r\n\r\n    function hideFilters() {\r\n      document.querySelector('.filters').classList.add('hidden');\r\n    }\r\n\r\n    function addPictureBlock(arr, callback) {\r\n      hideFilters();\r\n      gallery.setPictures(arr);\r\n\r\n      if (typeof callback === 'function') {\r\n        callback();\r\n      }\r\n    }\r\n\r\n    var pageNumber = 0;\r\n    var pageSize = 12;\r\n    var footer = document.querySelector('footer');\r\n    var throttleTimeOut = 100;\r\n    var optimizedScroll = throttle(checkNextPage, throttleTimeOut);\r\n\r\n    function setActiveFilter() {\r\n      return localStorage.getItem('filter') || 'filter-popular';\r\n    }\r\n\r\n    function changeFilter(filterID) {\r\n      document.getElementById(filterID).checked = true;\r\n      document.querySelector('.pictures').innerHTML = '';\r\n      pageNumber = 0;\r\n      localStorage.setItem('filter', filterID);\r\n      setScroll();\r\n      gallery.pictures = [];\r\n      loadPhotos(filterID, pageNumber);\r\n    }\r\n\r\n    function calcBottomIndent() {\r\n      var pictureArr = document.querySelectorAll('.picture');\r\n      var lastPicture = pictureArr[pictureArr.length - 1];\r\n      if (lastPicture) {\r\n        var lastPictureTop = lastPicture.getBoundingClientRect().top;\r\n        var lastPictureBottom = lastPicture.getBoundingClientRect().bottom;\r\n        var lastPictureHight = lastPictureBottom - lastPictureTop;\r\n        return lastPictureHight;\r\n      } else {\r\n        return 100;\r\n      }\r\n    }\r\n\r\n    function setScroll() {\r\n      window.addEventListener('scroll', optimizedScroll);\r\n    }\r\n\r\n    function throttle(callback, timeout) {\r\n      var lastCall = Date.now();\r\n      return function() {\r\n        if (Date.now() - lastCall >= timeout) {\r\n          callback();\r\n          lastCall = Date.now();\r\n        }\r\n      };\r\n    }\r\n\r\n    function checkNextPage() {\r\n      if (footer.getBoundingClientRect().top - window.innerHeight <= calcBottomIndent()) {\r\n        loadPhotos(setActiveFilter(), ++pageNumber);\r\n      }\r\n    }\r\n\r\n    function checkFilter() {\r\n      document.querySelector('.filters').addEventListener('change', function(evt) {\r\n        if (evt.target.classList.contains('filters-radio')) {\r\n          changeFilter(evt.target.id);\r\n        }\r\n      });\r\n    }\r\n\r\n    function checkEndList(data, from, to) {\r\n      if (data.length < to - from) {\r\n        window.removeEventListener('scroll', optimizedScroll);\r\n      } else {\r\n        checkNextPage();\r\n      }\r\n    }\r\n\r\n    function loadPhotos(filter, currentPage) {\r\n      var from = currentPage * pageSize;\r\n      var to = (currentPage * pageSize) + pageSize;\r\n      load('/api/pictures', {\r\n        from: from,\r\n        to: to,\r\n        filter: filter\r\n      },\r\n      function(data) {\r\n        var pictures = data;\r\n        addPictureBlock(pictures, function() {\r\n          document.querySelector('.filters').classList.remove('hidden');\r\n          checkEndList(data, from, to);\r\n        });\r\n      });\r\n    }\r\n\r\n    changeFilter(setActiveFilter());\r\n    setScroll();\r\n    checkFilter();\r\n  });\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/js/pictures.js\n ** module id = 1\n ** module chunks = 0\n **/","'use strict';\r\n\r\ndefine(function() {\r\n\r\n  function getSearchString(params) {\r\n    return Object.keys(params).map(function(param) {\r\n      return [param, params[param]].join('=');\r\n    }).join('&');\r\n  }\r\n\r\n  function createCallBack(url, params, callback) {\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.open('GET', url + '?' + getSearchString(params));\r\n    xhr.onload = function(evt) {\r\n      var data = JSON.parse(evt.target.response);\r\n      callback(data);\r\n    };\r\n    xhr.send();\r\n  }\r\n\r\n  return createCallBack;\r\n});\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/js/load.js\n ** module id = 2\n ** module chunks = 0\n **/","'use strict';\r\n\r\ndefine(['./picture.js', './utils.js', './superclass.js', './picture-model.js'],\r\n  function(Picture, utils, SuperClass, PictureModel) {\r\n\r\n    var Gallery = function() {\r\n      SuperClass.call(this);\r\n\r\n      this.activePicture = null;\r\n      this.pictures = [];\r\n      this.overlay = document.querySelector('.gallery-overlay');\r\n      this.overlayClose = document.querySelector('.gallery-overlay-close');\r\n      this.overlayImage = document.querySelector('.gallery-overlay-image');\r\n      this.overlayLikes = document.querySelector('.likes-count');\r\n\r\n      this.hide = this.hide.bind(this);\r\n      this.overlayClose.addEventListener('click', this.hide);\r\n\r\n      this.showNextPicture = this.showNextPicture.bind(this);\r\n      this.overlayImage.addEventListener('click', this.showNextPicture);\r\n\r\n      this.callChangeLikes = this.callChangeLikes.bind(this);\r\n      this.overlayLikes.addEventListener('click', this.callChangeLikes);\r\n\r\n      this.restoreFromHash = this.restoreFromHash.bind(this);\r\n    };\r\n\r\n    utils.inherit(SuperClass, Gallery);\r\n\r\n    Gallery.prototype.setPictures = function(arr) {\r\n      var pictureModelList = arr.map(function(item) {\r\n        return (new PictureModel(item));\r\n      });\r\n      this.pictures = this.pictures.concat(pictureModelList);\r\n      this.render(pictureModelList);\r\n    };\r\n\r\n    Gallery.prototype.callChangeLikes = function() {\r\n      this.changeNumberLikes(this.pictures[this.activePicture]);\r\n    };\r\n\r\n    Gallery.prototype.render = function(arr) {\r\n      arr.forEach(function(model, i) {\r\n        model.index = i + this.pictures.length - arr.length;\r\n        var picture = new Picture(model);\r\n        picture.onclick = function() {\r\n          var url = picture.model.getUrl();\r\n          location.hash = '#photo/' + url;\r\n        };\r\n        picture.onclick = picture.onclick;\r\n        SuperClass.prototype.show.call(this, document.querySelector('.pictures'), picture.element);\r\n      }, this);\r\n      if (this.pictures.length === arr.length) {\r\n        window.addEventListener('hashchange', this.restoreFromHash);\r\n        this.restoreFromHash();\r\n      }\r\n    };\r\n\r\n    Gallery.prototype.restoreFromHash = function() {\r\n      var regexp = /#photo\\/(\\S+)/;\r\n      if (location.hash.match(regexp)) {\r\n        this.show(location.hash.match(regexp)[1]);\r\n      } else {\r\n        this.hide();\r\n      }\r\n    };\r\n\r\n    Gallery.prototype.show = function(url) {\r\n      this.overlay.classList.remove('invisible');\r\n      this.setActivePicture(url);\r\n    };\r\n\r\n    Gallery.prototype.showNextPicture = function(evt) {\r\n      if (evt.target === this.overlayImage) {\r\n        if (this.activePicture === this.pictures.length - 1) {\r\n          var firstPictureUrl = this.pictures[0].getUrl();\r\n          location.hash = '#photo/' + firstPictureUrl;\r\n        }\r\n        var nexPictureUrl = this.pictures[this.activePicture + 1].getUrl();\r\n        location.hash = '#photo/' + nexPictureUrl;\r\n      }\r\n    };\r\n\r\n    Gallery.prototype.hide = function() {\r\n      this.overlay.classList.add('invisible');\r\n      location.hash = '';\r\n    };\r\n\r\n    Gallery.prototype.changeNumberLikes = function(picture) {\r\n      if (this.overlayLikes.classList.contains('likes-count-liked')) {\r\n        this.overlayLikes.classList.remove('likes-count-liked');\r\n        picture.setLikes(picture.getLikes() - 1);\r\n        picture.liked = false;\r\n      } else {\r\n        this.overlayLikes.classList.add('likes-count-liked');\r\n        picture.setLikes(picture.getLikes() + 1);\r\n        picture.liked = true;\r\n      }\r\n    };\r\n\r\n    Gallery.prototype.setActivePicture = function(url) {\r\n      this.pictures.forEach(function(item) {\r\n        if (item.getUrl() === url) {\r\n          this.activePicture = item.index;\r\n          var picture = this.pictures[this.activePicture];\r\n          var imgSrc = url;\r\n          this.overlayImage.setAttribute('src', imgSrc);\r\n          document.querySelector('.likes-count').innerHTML = picture.getLikes();\r\n          document.querySelector('.comments-count').innerHTML = picture.getComments();\r\n          if (picture.liked === true) {\r\n            this.overlayLikes.classList.add('likes-count-liked');\r\n          } else {\r\n            this.overlayLikes.classList.remove('likes-count-liked');\r\n          }\r\n          window.addEventListener('change', function() {\r\n            document.querySelector('.likes-count').innerHTML = picture.getLikes();\r\n          });\r\n        }\r\n\r\n      }.bind(this));\r\n    };\r\n\r\n    return new Gallery();\r\n  });\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/js/gallery.js\n ** module id = 3\n ** module chunks = 0\n **/","'use strict';\r\n\r\ndefine(['./utils.js', './superclass.js'], function(utils, SuperClass) {\r\n\r\n  var Picture = function(model) {\r\n    SuperClass.call(this);\r\n\r\n    this.model = model;\r\n\r\n    this.element = this.createNode();\r\n\r\n    this.setPictureClick = this.setPictureClick.bind(this);\r\n    this.element.addEventListener('click', this.setPictureClick);\r\n  };\r\n\r\n  utils.inherit(SuperClass, Picture);\r\n\r\n  Picture.prototype.remove = function() {\r\n    this.element.removeEventListener('click', this.setPictureClick);\r\n    SuperClass.prototype.remove.call(this, this.element);\r\n  };\r\n\r\n  Picture.prototype.setPictureClick = function(event) {\r\n    event.preventDefault();\r\n    this.onclick();\r\n  };\r\n\r\n  Picture.prototype.createNode = function() {\r\n    var template = document.querySelector('#picture-template');\r\n    var templateContainer = 'content' in template ? template.content : template;\r\n    var img = new Image();\r\n    var imgNode = templateContainer.querySelector('.picture').cloneNode(true);\r\n\r\n    img.onload = function() {\r\n      imgNode.querySelector('img').setAttribute('src', img.src);\r\n      imgNode.querySelector('img').setAttribute('width', 182);\r\n      imgNode.querySelector('img').setAttribute('height', 182);\r\n      imgNode.querySelector('.picture-likes').insertAdjacentHTML('afterBegin', this.model.getLikes());\r\n      imgNode.querySelector('.picture-comments').insertAdjacentHTML('afterBegin', this.model.getComments());\r\n      window.addEventListener('change', function() {\r\n        var pictureLikes = imgNode.querySelector('.picture-likes');\r\n        if (pictureLikes !== null) {\r\n          pictureLikes.innerHTML = '';\r\n          pictureLikes.insertAdjacentHTML('afterBegin', this.model.getLikes());\r\n        }\r\n      }.bind(this));\r\n    }.bind(this);\r\n\r\n    img.src = this.model.getUrl();\r\n\r\n    img.onerror = function() {\r\n      imgNode.classList.add('picture-load-failure');\r\n    };\r\n\r\n    return imgNode;\r\n  };\r\n\r\n  return Picture;\r\n\r\n});\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/js/picture.js\n ** module id = 4\n ** module chunks = 0\n **/","'use strict';\r\n\r\ndefine(function() {\r\n\r\n  var utils = {};\r\n\r\n  utils.inherit = function(Parent, Child) {\r\n    var EmptyConstructor = function() {};\r\n    EmptyConstructor.prototype = Parent.prototype;\r\n    Child.prototype = new EmptyConstructor();\r\n  };\r\n\r\n  return utils;\r\n});\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/js/utils.js\n ** module id = 5\n ** module chunks = 0\n **/","'use strict';\r\n\r\ndefine(function() {\r\n\r\n  var SuperClass = function(data) {\r\n    this.element = data;\r\n  };\r\n\r\n  SuperClass.prototype.show = function(parent, element) {\r\n    parent.appendChild(element);\r\n  };\r\n\r\n  SuperClass.prototype.remove = function(element) {\r\n    if (element.parentNode) {\r\n      element.parentNode.removeChild(element);\r\n    }\r\n    return;\r\n  };\r\n\r\n  return SuperClass;\r\n});\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/js/superclass.js\n ** module id = 6\n ** module chunks = 0\n **/","'use strict';\r\n\r\ndefine(function() {\r\n\r\n  var PictureModel = function(data) {\r\n    this.data = data;\r\n    this.list = [];\r\n    this.liked = false;\r\n  };\r\n\r\n  PictureModel.prototype.getUrl = function() {\r\n    return this.data.preview || this.data.url;\r\n  };\r\n\r\n  PictureModel.prototype.getLikes = function() {\r\n    return this.data.likes;\r\n  };\r\n\r\n  PictureModel.prototype.getComments = function() {\r\n    return this.data.comments;\r\n  };\r\n\r\n  PictureModel.prototype.getCreated = function() {\r\n    return new Date(this.data.created);\r\n  };\r\n\r\n  PictureModel.prototype.setLikes = function(number) {\r\n    this.data.likes = number;\r\n    this.changeLikes();\r\n  };\r\n\r\n  PictureModel.prototype.setComments = function(number) {\r\n    this.data.comments = number;\r\n  };\r\n\r\n  PictureModel.prototype.changeLikes = function() {\r\n    var changeLikes = new CustomEvent('change');\r\n    window.dispatchEvent(changeLikes);\r\n  };\r\n\r\n  return PictureModel;\r\n});\r\n\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/js/picture-model.js\n ** module id = 7\n ** module chunks = 0\n **/","/* global Resizer: true */\r\n\r\n/**\r\n * @fileoverview\r\n * @author Igor Alexeenko (o0)\r\n */\r\n\r\n'use strict';\r\ndefine(['./cookies.js'], function(cookies) {\r\n  (function() {\r\n    try {\r\n      new CustomEvent('IE has CustomEvent, but doesn\\'t support constructor'); // eslint-disable-line\r\n    } catch (e) {\r\n      window.CustomEvent = function(event, params) {\r\n        var evt;\r\n        params = params || {\r\n          bubbles: false,\r\n          cancelable: false,\r\n          detail: null\r\n        };\r\n        evt = document.createEvent('CustomEvent');\r\n        evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\r\n        return evt;\r\n      };\r\n\r\n      CustomEvent.prototype = Object.create(window.Event.prototype);\r\n    }\r\n    /** @enum {string} */\r\n    var FileType = {\r\n      'GIF': '',\r\n      'JPEG': '',\r\n      'PNG': '',\r\n      'SVG+XML': ''\r\n    };\r\n\r\n    /** @enum {number} */\r\n    var Action = {\r\n      ERROR: 0,\r\n      UPLOADING: 1,\r\n      CUSTOM: 2\r\n    };\r\n\r\n    /**\r\n     * Регулярное выражение, проверяющее тип загружаемого файла. Составляется\r\n     * из ключей FileType.\r\n     * @type {RegExp}\r\n     */\r\n    var fileRegExp = new RegExp('^image/(' + Object.keys(FileType).join('|').replace('\\+', '\\\\+') + ')$', 'i');\r\n\r\n    /**\r\n     * @type {Object.<string, string>}\r\n     */\r\n    var filterMap;\r\n\r\n    /**\r\n     * Объект, который занимается кадрированием изображения.\r\n     * @type {Resizer}\r\n     */\r\n    var currentResizer;\r\n\r\n\r\n    /**\r\n     * Удаляет текущий объект {@link Resizer}, чтобы создать новый с другим\r\n     * изображением.\r\n     */\r\n    var cleanupResizer = function() {\r\n      if (currentResizer) {\r\n        currentResizer.remove();\r\n        currentResizer = null;\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Ставит одну из трех случайных картинок на фон формы загрузки.\r\n     */\r\n    var updateBackground = function() {\r\n      var images = [\r\n        'img/logo-background-1.jpg',\r\n        'img/logo-background-2.jpg',\r\n        'img/logo-background-3.jpg'\r\n      ];\r\n\r\n      var backgroundElement = document.querySelector('.upload');\r\n      var randomImageNumber = Math.round(Math.random() * (images.length - 1));\r\n      backgroundElement.style.backgroundImage = 'url(' + images[randomImageNumber] + ')';\r\n    };\r\n\r\n    /**\r\n     * Проверяет, валидны ли данные, в форме кадрирования.\r\n     * @return {boolean}\r\n     */\r\n\r\n    var resizeControls = document.getElementsByClassName('upload-resize-control');\r\n\r\n    for (var i = 0; i < resizeControls.length; i++) {\r\n      var inputElement = resizeControls[i];\r\n      inputElement.value = 0;\r\n      if (inputElement.id === 'resize-x' || inputElement.id === 'resize-y') {\r\n        inputElement.min = 0;\r\n      }\r\n      inputElement.addEventListener('input', validate);\r\n    }\r\n\r\n    function validate() {\r\n      if (resizeFormIsValid()) {\r\n        document.getElementById('resize-fwd').removeAttribute('disabled');\r\n      } else {\r\n        document.getElementById('resize-fwd').setAttribute('disabled', 'disabled');\r\n      }\r\n    }\r\n\r\n    var resizeFormIsValid = function() {\r\n      var horizontalOffset = +document.getElementById('resize-x').value;\r\n      var verticalOffset = +document.getElementById('resize-y').value;\r\n      var side = +document.getElementById('resize-size').value;\r\n      var sumXSide = horizontalOffset + side;\r\n      var sumYSide = verticalOffset + side;\r\n      return sumXSide <= currentResizer._image.naturalWidth &&\r\n        sumYSide <= currentResizer._image.naturalHeight;\r\n    };\r\n\r\n    /**\r\n     * Форма загрузки изображения.\r\n     * @type {HTMLFormElement}\r\n     */\r\n    var uploadForm = document.forms['upload-select-image'];\r\n\r\n    /**\r\n     * Форма кадрирования изображения.\r\n     * @type {HTMLFormElement}\r\n     */\r\n    var resizeForm = document.forms['upload-resize'];\r\n\r\n\r\n    /**\r\n     * Форма добавления фильтра.\r\n     * @type {HTMLFormElement}\r\n     */\r\n    var filterForm = document.forms['upload-filter'];\r\n\r\n    /**\r\n     * @type {HTMLImageElement}\r\n     */\r\n    var filterImage = filterForm.querySelector('.filter-image-preview');\r\n\r\n    /**\r\n     * @type {HTMLElement}\r\n     */\r\n    var uploadMessage = document.querySelector('.upload-message');\r\n\r\n    /**\r\n     * @param {Action} action\r\n     * @param {string=} message\r\n     * @return {Element}\r\n     */\r\n    var showMessage = function(action, message) {\r\n      var isError = false;\r\n\r\n      switch (action) {\r\n        case Action.UPLOADING:\r\n          message = message || 'Кексограмим&hellip;';\r\n          break;\r\n\r\n        case Action.ERROR:\r\n          isError = true;\r\n          message = message || 'Неподдерживаемый формат файла<br> <a href=\"' + document.location + '\">Попробовать еще раз</a>.';\r\n          break;\r\n      }\r\n\r\n      uploadMessage.querySelector('.upload-message-container').innerHTML = message;\r\n      uploadMessage.classList.remove('invisible');\r\n      uploadMessage.classList.toggle('upload-message-error', isError);\r\n      return uploadMessage;\r\n    };\r\n\r\n    var hideMessage = function() {\r\n      uploadMessage.classList.add('invisible');\r\n    };\r\n\r\n    /**\r\n     * Обработчик изменения изображения в форме загрузки. Если загруженный\r\n     * файл является изображением, считывается исходник картинки, создается\r\n     * Resizer с загруженной картинкой, добавляется в форму кадрирования\r\n     * и показывается форма кадрирования.\r\n     * @param {Event} evt\r\n     */\r\n    uploadForm.addEventListener('change', function(evt) {\r\n      var element = evt.target;\r\n      if (element.id === 'upload-file') {\r\n        // Проверка типа загружаемого файла, тип должен быть изображением\r\n        // одного из форматов: JPEG, PNG, GIF или SVG.\r\n        if (fileRegExp.test(element.files[0].type)) {\r\n          var fileReader = new FileReader();\r\n\r\n          showMessage(Action.UPLOADING);\r\n\r\n          fileReader.addEventListener('load', function() {\r\n            cleanupResizer();\r\n\r\n            currentResizer = new Resizer(fileReader.result);\r\n            currentResizer.setElement(resizeForm);\r\n            uploadMessage.classList.add('invisible');\r\n\r\n            uploadForm.classList.add('invisible');\r\n            resizeForm.classList.remove('invisible');\r\n\r\n            hideMessage();\r\n          });\r\n\r\n          fileReader.readAsDataURL(element.files[0]);\r\n        } else {\r\n          // Показ сообщения об ошибке, если формат загружаемого файла не поддерживается\r\n          showMessage(Action.ERROR);\r\n        }\r\n      }\r\n    });\r\n\r\n    /**\r\n     * Обработка сброса формы кадрирования. Возвращает в начальное состояние\r\n     * и обновляет фон.\r\n     * @param {Event} evt\r\n     */\r\n    resizeForm.addEventListener('reset', function(evt) {\r\n      evt.preventDefault();\r\n\r\n      cleanupResizer();\r\n      updateBackground();\r\n\r\n      resizeForm.classList.add('invisible');\r\n      uploadForm.classList.remove('invisible');\r\n    });\r\n\r\n    var resizeX = document.querySelector('#resize-x');\r\n    var resizeY = document.querySelector('#resize-y');\r\n    var resizeSize = document.querySelector('#resize-size');\r\n\r\n    var eventResize = new CustomEvent('resizerchange');\r\n    window.addEventListener('resizerchange', function() {\r\n      if (currentResizer) {\r\n        resizeX.value = Math.round(currentResizer.getConstraint().x);\r\n        resizeY.value = Math.round(currentResizer.getConstraint().y);\r\n        resizeSize.value = Math.round(currentResizer.getConstraint().side);\r\n      }\r\n    });\r\n\r\n    window.dispatchEvent(eventResize);\r\n\r\n    var uploadResizeControls = document.querySelector('.upload-resize-controls');\r\n    uploadResizeControls.addEventListener('input', function() {\r\n      var valueX = parseInt(resizeX.value, 10);\r\n      var valueY = parseInt(resizeY.value, 10);\r\n      var valueSize = parseInt(resizeSize.value, 10);\r\n\r\n      currentResizer.setConstraint(valueX, valueY, valueSize);\r\n    });\r\n\r\n    /**\r\n     * Обработка отправки формы кадрирования. Если форма валидна, экспортирует\r\n     * кропнутое изображение в форму добавления фильтра и показывает ее.\r\n     * @param {Event} evt\r\n     */\r\n    resizeForm.addEventListener('submit', function(evt) {\r\n      evt.preventDefault();\r\n\r\n      if (resizeFormIsValid()) {\r\n        var image = currentResizer.exportImage().src;\r\n\r\n        var thumbnails = filterForm.querySelectorAll('.upload-filter-preview');\r\n        for (i = 0; i < thumbnails.length; i++) {\r\n          thumbnails[i].style.backgroundImage = 'url(' + image + ')';\r\n        }\r\n\r\n        filterImage.src = image;\r\n\r\n        resizeForm.classList.add('invisible');\r\n        filterForm.classList.remove('invisible');\r\n        cookies.setFilterName(filterForm['upload-filter'], filterForm);\r\n      }\r\n    });\r\n\r\n    /**\r\n     * Сброс формы фильтра. Показывает форму кадрирования.\r\n     * @param {Event} evt\r\n     */\r\n    filterForm.addEventListener('reset', function(evt) {\r\n      evt.preventDefault();\r\n\r\n      filterForm.classList.add('invisible');\r\n      resizeForm.classList.remove('invisible');\r\n    });\r\n\r\n    /**\r\n     * Отправка формы фильтра. Возвращает в начальное состояние, предварительно\r\n     * записав сохраненный фильтр в cookie.\r\n     * @param {Event} evt\r\n     */\r\n\r\n    filterForm.addEventListener('submit', function(evt) {\r\n      evt.preventDefault();\r\n\r\n      cleanupResizer();\r\n      updateBackground();\r\n      filterForm.classList.add('invisible');\r\n      uploadForm.classList.remove('invisible');\r\n    });\r\n\r\n    /**\r\n     * Обработчик изменения фильтра. Добавляет класс из filterMap соответствующий\r\n     * выбранному значению в форме.\r\n     */\r\n    filterForm.addEventListener('change', function() {\r\n      if (!filterMap) {\r\n        // Ленивая инициализация. Объект не создается до тех пор, пока\r\n        // не понадобится прочитать его в первый раз, а после этого запоминается\r\n        // навсегда.\r\n        filterMap = {\r\n          'none': 'filter-none',\r\n          'chrome': 'filter-chrome',\r\n          'sepia': 'filter-sepia',\r\n          'marvin': 'filter-marvin'\r\n        };\r\n      }\r\n\r\n      var selectedFilter = [].filter.call(filterForm['upload-filter'], function(item) {\r\n        return item.checked;\r\n      })[0].value;\r\n\r\n      // Класс перезаписывается, а не обновляется через classList потому что нужно\r\n      // убрать предыдущий примененный класс. Для этого нужно или запоминать его\r\n      // состояние или просто перезаписывать.\r\n      filterImage.className = 'filter-image-preview ' + filterMap[selectedFilter];\r\n      cookies.setNewCookie(filterMap[selectedFilter]);\r\n    });\r\n\r\n    cleanupResizer();\r\n    updateBackground();\r\n  })();\r\n});\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/js/upload.js\n ** module id = 8\n ** module chunks = 0\n **/","'use strict';\r\n\r\ndefine(function() {\r\n  function getLastGraceBithday() {\r\n    var graceBirthday = new Date();\r\n    graceBirthday.setMonth(11, 9);\r\n    var now = new Date();\r\n\r\n    if (graceBirthday > now) {\r\n      return graceBirthday.setFullYear(graceBirthday.getFullYear() - 1);\r\n    }\r\n    return graceBirthday;\r\n  }\r\n\r\n  function getExpireCookiesDate() {\r\n    var days = 24 * 60 * 60 * 1000;\r\n    return Math.floor((new Date() - getLastGraceBithday()) / days);\r\n  }\r\n\r\n  function setCookie(filter) {\r\n    window.Cookies.set('upload-filter', filter, { expires: getExpireCookiesDate() });\r\n  }\r\n\r\n  function getFilterNameFromCookies() {\r\n    return window.Cookies.get('upload-filter');\r\n  }\r\n\r\n  function setCurrentFilterName(list, form) {\r\n    if (getFilterNameFromCookies() === null) {\r\n      return;\r\n    }\r\n    for (var i = 0; i < list.length; i++) {\r\n      if (list[i].id === 'upload-' + getFilterNameFromCookies()) {\r\n        list[i].setAttribute('checked', 'checked');\r\n        var event = null;\r\n        if (navigator.appName.indexOf('Internet Explorer') !== -1) {\r\n          event = new CustomEvent('change');\r\n        } else {\r\n          event = new Event('change');\r\n        }\r\n        form.dispatchEvent(event);\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    setFilterName: setCurrentFilterName,\r\n    setNewCookie: setCookie\r\n  };\r\n});\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/js/cookies.js\n ** module id = 9\n ** module chunks = 0\n **/","'use strict';\r\n\r\ndefine(function() {\r\n  (function() {\r\n    /**\r\n     * @constructor\r\n     * @param {string} image\r\n     */\r\n    var Resizer = function(image) {\r\n      // Изображение, с которым будет вестись работа.\r\n      this._image = new Image();\r\n      this._image.src = image;\r\n\r\n      // Холст.\r\n      this._container = document.createElement('canvas');\r\n      this._ctx = this._container.getContext('2d');\r\n\r\n      // Создаем холст только после загрузки изображения.\r\n      this._image.onload = function() {\r\n        // Размер холста равен размеру загруженного изображения. Это нужно\r\n        // для удобства работы с координатами.\r\n        this._container.width = this._image.naturalWidth;\r\n        this._container.height = this._image.naturalHeight;\r\n\r\n        /**\r\n         * Предлагаемый размер кадра в виде коэффициента относительно меньшей\r\n         * стороны изображения.\r\n         * @const\r\n         * @type {number}\r\n         */\r\n        var INITIAL_SIDE_RATIO = 0.75;\r\n\r\n        // Размер меньшей стороны изображения.\r\n        var side = Math.min(\r\n            this._container.width * INITIAL_SIDE_RATIO,\r\n            this._container.height * INITIAL_SIDE_RATIO);\r\n\r\n        // Изначально предлагаемое кадрирование — часть по центру с размером в 3/4\r\n        // от размера меньшей стороны.\r\n        this._resizeConstraint = new Square(\r\n            this._container.width / 2 - side / 2,\r\n            this._container.height / 2 - side / 2,\r\n            side);\r\n\r\n        // Отрисовка изначального состояния канваса.\r\n        this.setConstraint();\r\n      }.bind(this);\r\n\r\n      // Фиксирование контекста обработчиков.\r\n      this._onDragStart = this._onDragStart.bind(this);\r\n      this._onDragEnd = this._onDragEnd.bind(this);\r\n      this._onDrag = this._onDrag.bind(this);\r\n    };\r\n\r\n    Resizer.prototype = {\r\n      /**\r\n       * Родительский элемент канваса.\r\n       * @type {Element}\r\n       * @private\r\n       */\r\n      _element: null,\r\n\r\n      /**\r\n       * Положение курсора в момент перетаскивания. От положения курсора\r\n       * рассчитывается смещение на которое нужно переместить изображение\r\n       * за каждую итерацию перетаскивания.\r\n       * @type {Coordinate}\r\n       * @private\r\n       */\r\n      _cursorPosition: null,\r\n\r\n      /**\r\n       * Объект, хранящий итоговое кадрирование: сторона квадрата и смещение\r\n       * от верхнего левого угла исходного изображения.\r\n       * @type {Square}\r\n       * @private\r\n       */\r\n      _resizeConstraint: null,\r\n\r\n      /**\r\n       * Отрисовка канваса.\r\n       */\r\n      redraw: function() {\r\n        // Очистка изображения.\r\n        this._ctx.clearRect(0, 0, this._container.width, this._container.height);\r\n\r\n        // Параметры линии.\r\n        // NB! Такие параметры сохраняются на время всего процесса отрисовки\r\n        // canvas'a поэтому важно вовремя поменять их, если нужно начать отрисовку\r\n        // чего-либо с другой обводкой.\r\n\r\n        // Толщина линии.\r\n        this._ctx.lineWidth = 6;\r\n        // Цвет обводки.\r\n        this._ctx.strokeStyle = '#ffe753';\r\n\r\n        // Сохранение состояния канваса.\r\n        this._ctx.save();\r\n\r\n        // Установка начальной точки системы координат в центр холста.\r\n        this._ctx.translate(this._container.width / 2, this._container.height / 2);\r\n\r\n        var displX = -(this._resizeConstraint.x + this._resizeConstraint.side / 2);\r\n        var displY = -(this._resizeConstraint.y + this._resizeConstraint.side / 2);\r\n        // Отрисовка изображения на холсте. Параметры задают изображение, которое\r\n        // нужно отрисовать и координаты его верхнего левого угла.\r\n        // Координаты задаются от центра холста.\r\n        this._ctx.drawImage(this._image, displX, displY);\r\n\r\n        // Отрисовка прямоугольника, обозначающего область изображения после\r\n        // кадрирования. Координаты задаются от центра.\r\n        // this._ctx.strokeRect(\r\n\r\n        var size = Math.round(this._resizeConstraint.side - this._ctx.lineWidth / 2);\r\n\r\n        this._ctx.translate(-this._container.width / 2, -this._container.height / 2);\r\n\r\n        var innerFrame = {};\r\n        innerFrame.side = Math.round(size + this._ctx.lineWidth);\r\n\r\n        var offsetX = Math.round( this._ctx.lineWidth / 2 ) + 1;\r\n        var offsetY = Math.round( this._ctx.lineWidth / 2 ) + 1;\r\n\r\n        var self = this;\r\n\r\n        var blocks = [];\r\n\r\n        blocks[0] = {};\r\n        blocks[0].x = 0;\r\n        blocks[0].y = 0;\r\n        blocks[0].width = this._container.width;\r\n        blocks[0].height = Math.round((this._container.height - innerFrame.side) / 2) - offsetY;\r\n\r\n        blocks[1] = {};\r\n        blocks[1].x = blocks[0].x;\r\n        blocks[1].y = blocks[0].y + blocks[0].height;\r\n        blocks[1].width = Math.round((this._container.width - innerFrame.side) / 2) - offsetX;\r\n        blocks[1].height = innerFrame.side;\r\n\r\n        blocks[2] = {};\r\n        blocks[2].x = blocks[0].x;\r\n        blocks[2].y = blocks[1].y + blocks[1].height;\r\n        blocks[2].width = blocks[0].width;\r\n        blocks[2].height = this._container.height - blocks[0].height - blocks[1].height;\r\n\r\n        blocks[3] = {};\r\n        blocks[3].x = blocks[0].x + blocks[1].width + innerFrame.side;\r\n        blocks[3].y = blocks[1].y;\r\n        blocks[3].width = this._container.width - blocks[3].x;\r\n        blocks[3].height = blocks[1].height;\r\n\r\n        this._ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';\r\n\r\n        function drawOutFrame(arr) {\r\n          arr.forEach(function(item) {\r\n            self._ctx.fillRect(item.x, item.y, item.width, item.height);\r\n          });\r\n        }\r\n\r\n        drawOutFrame(blocks);\r\n\r\n        this._ctx.fillStyle = '#FFF';\r\n        this._ctx.textAlign = 'center';\r\n        this._ctx.font = '30px Tahoma';\r\n        this._ctx.textBaseline = 'bottom';\r\n        this._ctx.fillText(this._image.naturalWidth + ' x ' + this._image.naturalHeight,\r\n          this._container.width / 2, blocks[0].height);\r\n\r\n        this._ctx.translate(Math.round(this._container.width / 2), Math.round(this._container.height / 2));\r\n\r\n        var lineLength = 12;\r\n        var zigzagXFirst = Math.floor((-this._resizeConstraint.side / 2) - this._ctx.lineWidth / 2);\r\n        var zigzagYFirst = Math.floor((-this._resizeConstraint.side / 2) - this._ctx.lineWidth / 2);\r\n        var zigzagLineX = zigzagXFirst;\r\n        var zigzagLineY = zigzagYFirst;\r\n        var zigzagLineLengthHor = Math.floor((this._resizeConstraint.side - this._ctx.lineWidth / 2) + zigzagXFirst);\r\n        var zigzagLineLengthVer = Math.floor((this._resizeConstraint.side - this._ctx.lineWidth / 2) + zigzagYFirst);\r\n\r\n        this._ctx.lineCap = 'square';\r\n\r\n        while (zigzagLineX <= zigzagLineLengthHor - lineLength / 2) {\r\n          this._ctx.beginPath();\r\n          this._ctx.moveTo(zigzagLineX, zigzagLineY);\r\n          zigzagLineX = zigzagLineX + lineLength;\r\n          zigzagLineY = zigzagLineY - lineLength;\r\n          this._ctx.lineTo(zigzagLineX, zigzagLineY);\r\n          zigzagLineX = zigzagLineX + lineLength;\r\n          zigzagLineY = zigzagLineY + lineLength;\r\n          this._ctx.lineTo(zigzagLineX, zigzagLineY);\r\n          this._ctx.stroke();\r\n        }\r\n\r\n        while (zigzagLineY <= zigzagLineLengthVer - lineLength / 2) {\r\n          this._ctx.beginPath();\r\n          this._ctx.moveTo(zigzagLineX, zigzagLineY);\r\n          zigzagLineX = zigzagLineX - lineLength;\r\n          zigzagLineY = zigzagLineY + lineLength;\r\n          this._ctx.lineTo(zigzagLineX, zigzagLineY);\r\n          zigzagLineX = zigzagLineX + lineLength;\r\n          zigzagLineY = zigzagLineY + lineLength;\r\n          this._ctx.lineTo(zigzagLineX, zigzagLineY);\r\n          this._ctx.stroke();\r\n        }\r\n\r\n        while (zigzagLineX >= zigzagXFirst + lineLength / 2) {\r\n          this._ctx.beginPath();\r\n          this._ctx.moveTo(zigzagLineX, zigzagLineY);\r\n          zigzagLineX = zigzagLineX - lineLength;\r\n          zigzagLineY = zigzagLineY + lineLength;\r\n          this._ctx.lineTo(zigzagLineX, zigzagLineY);\r\n          zigzagLineX = zigzagLineX - lineLength;\r\n          zigzagLineY = zigzagLineY - lineLength;\r\n          this._ctx.lineTo(zigzagLineX, zigzagLineY);\r\n          this._ctx.stroke();\r\n        }\r\n\r\n        while (zigzagLineY >= zigzagYFirst + lineLength / 2) {\r\n          this._ctx.beginPath();\r\n          this._ctx.moveTo(zigzagLineX, zigzagLineY);\r\n          zigzagLineX = zigzagLineX + lineLength;\r\n          zigzagLineY = zigzagLineY - lineLength;\r\n          this._ctx.lineTo(zigzagLineX, zigzagLineY);\r\n          zigzagLineX = zigzagLineX - lineLength;\r\n          zigzagLineY = zigzagLineY - lineLength;\r\n          this._ctx.lineTo(zigzagLineX, zigzagLineY);\r\n          this._ctx.stroke();\r\n        }\r\n\r\n        // Восстановление состояния канваса, которое было до вызова ctx.save\r\n        // и последующего изменения системы координат. Нужно для того, чтобы\r\n        // следующий кадр рисовался с привычной системой координат, где точка\r\n        // 0 0 находится в левом верхнем углу холста, в противном случае\r\n        // некорректно сработает даже очистка холста или нужно будет использовать\r\n        // сложные рассчеты для координат прямоугольника, который нужно очистить.\r\n        this._ctx.restore();\r\n\r\n      },\r\n\r\n      /**\r\n       * Включение режима перемещения. Запоминается текущее положение курсора,\r\n       * устанавливается флаг, разрешающий перемещение и добавляются обработчики,\r\n       * позволяющие перерисовывать изображение по мере перетаскивания.\r\n       * @param {number} x\r\n       * @param {number} y\r\n       * @private\r\n       */\r\n      _enterDragMode: function(x, y) {\r\n        this._cursorPosition = new Coordinate(x, y);\r\n        document.body.addEventListener('mousemove', this._onDrag);\r\n        document.body.addEventListener('mouseup', this._onDragEnd);\r\n      },\r\n\r\n      /**\r\n       * Выключение режима перемещения.\r\n       * @private\r\n       */\r\n      _exitDragMode: function() {\r\n        this._cursorPosition = null;\r\n        document.body.removeEventListener('mousemove', this._onDrag);\r\n        document.body.removeEventListener('mouseup', this._onDragEnd);\r\n      },\r\n\r\n      /**\r\n       * Перемещение изображения относительно кадра.\r\n       * @param {number} x\r\n       * @param {number} y\r\n       * @private\r\n       */\r\n      updatePosition: function(x, y) {\r\n        this.moveConstraint(\r\n            this._cursorPosition.x - x,\r\n            this._cursorPosition.y - y);\r\n        this._cursorPosition = new Coordinate(x, y);\r\n      },\r\n\r\n      /**\r\n       * @param {MouseEvent} evt\r\n       * @private\r\n       */\r\n      _onDragStart: function(evt) {\r\n        this._enterDragMode(evt.clientX, evt.clientY);\r\n      },\r\n\r\n      /**\r\n       * Обработчик окончания перетаскивания.\r\n       * @private\r\n       */\r\n      _onDragEnd: function() {\r\n        this._exitDragMode();\r\n      },\r\n\r\n      /**\r\n       * Обработчик события перетаскивания.\r\n       * @param {MouseEvent} evt\r\n       * @private\r\n       */\r\n      _onDrag: function(evt) {\r\n        this.updatePosition(evt.clientX, evt.clientY);\r\n      },\r\n\r\n      /**\r\n       * Добавление элемента в DOM.\r\n       * @param {Element} element\r\n       */\r\n      setElement: function(element) {\r\n        if (this._element === element) {\r\n          return;\r\n        }\r\n\r\n        this._element = element;\r\n        this._element.insertBefore(this._container, this._element.firstChild);\r\n        // Обработчики начала и конца перетаскивания.\r\n        this._container.addEventListener('mousedown', this._onDragStart);\r\n      },\r\n\r\n      /**\r\n       * Возвращает кадрирование элемента.\r\n       * @return {Square}\r\n       */\r\n      getConstraint: function() {\r\n        return this._resizeConstraint;\r\n      },\r\n\r\n      /**\r\n       * Смещает кадрирование на значение указанное в параметрах.\r\n       * @param {number} deltaX\r\n       * @param {number} deltaY\r\n       * @param {number} deltaSide\r\n       */\r\n      moveConstraint: function(deltaX, deltaY, deltaSide) {\r\n        this.setConstraint(\r\n            this._resizeConstraint.x + (deltaX || 0),\r\n            this._resizeConstraint.y + (deltaY || 0),\r\n            this._resizeConstraint.side + (deltaSide || 0));\r\n      },\r\n\r\n      /**\r\n       * @param {number} x\r\n       * @param {number} y\r\n       * @param {number} side\r\n       */\r\n      setConstraint: function(x, y, side) {\r\n        if (typeof x !== 'undefined') {\r\n          this._resizeConstraint.x = x;\r\n        }\r\n\r\n        if (typeof y !== 'undefined') {\r\n          this._resizeConstraint.y = y;\r\n        }\r\n\r\n        if (typeof side !== 'undefined') {\r\n          this._resizeConstraint.side = side;\r\n        }\r\n\r\n        requestAnimationFrame(function() {\r\n          this.redraw();\r\n          var resizerChangeEvent = document.createEvent('CustomEvent');\r\n          resizerChangeEvent.initEvent('resizerchange', false, false);\r\n          window.dispatchEvent(resizerChangeEvent);\r\n        }.bind(this));\r\n      },\r\n\r\n      /**\r\n       * Удаление. Убирает контейнер из родительского элемента, убирает\r\n       * все обработчики событий и убирает ссылки.\r\n       */\r\n      remove: function() {\r\n        this._element.removeChild(this._container);\r\n\r\n        this._container.removeEventListener('mousedown', this._onDragStart);\r\n        this._container = null;\r\n      },\r\n\r\n      /**\r\n       * Экспорт обрезанного изображения как HTMLImageElement и исходником\r\n       * картинки в src в формате dataURL.\r\n       * @return {Image}\r\n       */\r\n      exportImage: function() {\r\n        // Создаем Image, с размерами, указанными при кадрировании.\r\n        var imageToExport = new Image();\r\n\r\n        // Создается новый canvas, по размерам совпадающий с кадрированным\r\n        // изображением, в него добавляется изображение взятое из канваса\r\n        // с измененными координатами и сохраняется в dataURL, с помощью метода\r\n        // toDataURL. Полученный исходный код, записывается в src у ранее\r\n        // созданного изображения.\r\n        var temporaryCanvas = document.createElement('canvas');\r\n        var temporaryCtx = temporaryCanvas.getContext('2d');\r\n        temporaryCanvas.width = this._resizeConstraint.side;\r\n        temporaryCanvas.height = this._resizeConstraint.side;\r\n        temporaryCtx.drawImage(this._image,\r\n            -this._resizeConstraint.x,\r\n            -this._resizeConstraint.y);\r\n        imageToExport.src = temporaryCanvas.toDataURL('image/png');\r\n\r\n        return imageToExport;\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Вспомогательный тип, описывающий квадрат.\r\n     * @constructor\r\n     * @param {number} x\r\n     * @param {number} y\r\n     * @param {number} side\r\n     * @private\r\n     */\r\n    var Square = function(x, y, side) {\r\n      this.x = x;\r\n      this.y = y;\r\n      this.side = side;\r\n    };\r\n\r\n    /**\r\n     * Вспомогательный тип, описывающий координату.\r\n     * @constructor\r\n     * @param {number} x\r\n     * @param {number} y\r\n     * @private\r\n     */\r\n    var Coordinate = function(x, y) {\r\n      this.x = x;\r\n      this.y = y;\r\n    };\r\n\r\n    window.Resizer = Resizer;\r\n  })();\r\n});\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/js/resizer.js\n ** module id = 10\n ** module chunks = 0\n **/"],"sourceRoot":""}